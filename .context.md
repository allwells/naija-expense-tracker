# NaijaExpense — Project Context

## What This Is

A production-grade personal/business expense tracker built specifically for Nigerian freelancers, SMEs, and professionals. The core differentiator is deep integration with Nigeria's **2026 Tax Reform Act** — the app doesn't just track money, it computes actual tax liability in real time.

## Primary User

Nigerian business owner or freelancer who:

- Earns income in multiple currencies (NGN, USD, EUR)
- Needs to track deductible vs non-deductible expenses
- Wants to know whether they qualify for the small business CIT exemption
- Needs an audit-ready export for FIRS or their accountant

## Tech Stack

| Concern         | Tool                                            |
| --------------- | ----------------------------------------------- |
| Framework       | Next.js 15, App Router, React Server Components |
| Auth            | better-auth (NOT Supabase Auth)                 |
| Database        | Supabase PostgreSQL                             |
| File Storage    | Supabase Storage                                |
| UI Components   | Shadcn/ui                                       |
| Styling         | Tailwind CSS v4                                 |
| Language        | TypeScript (strict)                             |
| OCR             | Tesseract.js (client-side, Web Worker)          |
| Charts          | Recharts (`.agent/skills/recharts/SKILL.md`)    |
| CSV Export      | csv-stringify                                   |
| Package Manager | Bun                                             |

## The 2026 Tax Reform Act — Key Rules (Effective Jan 1, 2026)

### Company Income Tax (CIT)

- **Small Business Exemption**: If annual turnover ≤ ₦100M AND fixed assets ≤ ₦250M → FULLY EXEMPT from CIT, CGT, and Development Levy
- **Standard Rate**: 30% CIT + 4% Development Levy on taxable profit (for non-exempt companies)

### Personal Income Tax (PIT) — New Brackets

| Income Range             | Rate                                       |
| ------------------------ | ------------------------------------------ |
| ₦0 – ₦800,000            | 0% (new tax-free threshold, up from ₦300k) |
| ₦800,001 – ₦2,000,000    | 15%                                        |
| ₦2,000,001 – ₦4,000,000  | 19%                                        |
| ₦4,000,001 – ₦6,000,000  | 21%                                        |
| ₦6,000,001 – ₦10,000,000 | 23%                                        |
| Above ₦10,000,000        | 25%                                        |

### Allowable Deductions

- **Rent Relief**: 20% of annual rent paid, maximum ₦500,000
- **Pension**: 8% of gross salary (employee portion)
- **NHF**: 2.5% of basic salary

### Capital Gains Tax (CGT)

- 10% standard rate
- Exempt for small businesses (turnover ≤ ₦100M, fixed assets ≤ ₦250M)
- Exempt for export-oriented businesses

### Dividends

- 10% withholding tax on dividends from Nigerian companies
- Exempt for dividends from export-oriented companies

## Deductibility Rules by Category

| Category                                                                                                                                                                     | Treatment                                   |
| ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------- |
| office_supplies, travel, software_subscriptions, utilities, salaries, marketing, professional_services, bank_charges, insurance, repairs_maintenance, fuel, airtime_internet | 100% deductible                             |
| meals_entertainment                                                                                                                                                          | 50% deductible                              |
| equipment                                                                                                                                                                    | Capital allowance (not immediate deduction) |
| rent                                                                                                                                                                         | Deductible if tagged 'business'             |
| personal                                                                                                                                                                     | Not deductible                              |

## Architecture Decisions

- **Server Actions** for all CRUD mutations — no client fetching to API routes for data
- **API Routes** only for: auth callbacks, streaming CSV exports, exchange rate proxy
- **Supabase RLS** enforces data isolation — users only see their own data
- **Exchange rates** fetched from ExchangeRate-API, cached in DB for 1 hour
- **OCR** runs entirely client-side in a Web Worker — no server round-trip for receipt scanning
- **Tax engine** is a pure TypeScript module with zero side effects — fully unit testable

## Build Phases (Summary)

| Phase | What Gets Built                                  |
| ----- | ------------------------------------------------ |
| 1     | Scaffold, auth, theme, PWA, shell pages          |
| 2     | Database schema, types, service layer            |
| 3     | Expense logging UI + OCR receipt scanning        |
| 4     | Income tracking                                  |
| 5     | Nigeria 2026 Tax Engine (critical — unit tested) |
| 6     | Dashboard + Reports with live tax numbers        |
| 7     | CSV export + audit package                       |
| 8     | Settings, onboarding, mobile polish              |

**IMPORTANT**: Each phase ends with a confirmation gate. Do not proceed to the next phase without explicit user confirmation.

## Naming Conventions

- Component folders: PascalCase (`ExpenseForm/`)
- Files inside: PascalCase for components (`ExpenseFormFields.tsx`), camelCase for hooks/utils (`use-expense-form.ts`)
- Database columns: snake_case
- TypeScript types: PascalCase interfaces (`ExpenseRecord`)
- Server actions: camelCase functions (`createExpense`)

## Key Constraints

1. Zero `any` in TypeScript — use `unknown` + type guards if needed
2. All UI via Shadcn/ui — no one-off custom primitives for things Shadcn covers
3. Mobile-first: design for 375px, then scale up
4. 2px borders, 0px border-radius everywhere (Shadcn theme override)
5. Geist font family only (sans + mono)
6. Dark mode supported via CSS variables (already in theme)
